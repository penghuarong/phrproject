<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
		*{
			margin:0;
			padding: 0;
		}
		#box{
			width: 300px;
			height: 300px;
			border:1px solid #000;
			position: relative;
			left:50%;
			top:200px;
		}
		#box img{
			width: 100%;
			height: 100%;
		}
		#box02{
			width: 300px;
			height: 300px;
			border:1px solid red;
			overflow: hidden;
			position: absolute;
			left: 310px;
			top: 0px;
		}
		#box02 img{
			position: absolute;
			left: 0;
			top: 0;
		}
		span{
			width: 100px;
			height: 100px;
			background: rgba(0,0,0,0.5);
			position: absolute;
			left: 0;
			top:0;
		}
	</style>
</head>
<body>
	<div id="box">
		<img src="4.jpg" alt="">
		<span></span>
	</div>
	<div id="box02">
		<img src="4.jpg" alt="">
	</div>
	<script src="../jquery-1.8.3.min.js"></script>
	<script>
		$(function(){
			$("#box span").on("mousedown",function(ev){
				var oEvent = ev||event;
				var cX = oEvent.clientX - $(this).position().left;
				var cY = oEvent.clientY - $(this).position().top;
				$(document).on("mousemove",function(ev){
					var oEvent = ev||event;
					var l = oEvent.clientX - cX;
					var t = oEvent.clientY - cY;

					if(l>=$("#box").width()-$("#box span").width()){
						l = $("#box").width()-$("#box span").width();
					}
					if(l<0){
						l = 0;
					}
					if(t>=$("#box").height()-$("#box span").height()){
						t = $("#box").height()-$("#box span").height();
					}
					if(t<0){
						t = 0;
					}
					$("#box span").css({"left":l+"px","top":t+"px"});

					var scaleX = l/($("#box").width()-$("#box span").width());
					var scaleY = t/($("#box").height()-$("#box span").height());
					var oLeft = scaleX*($("#box02 img").width()-$("#box02").width())
					var oTop = scaleY*($("#box02 img").height()-$("#box02").height());
					$("#box02 img").css({"left":-oLeft+"px","top":-oTop+"px"});
				});
				$(document).on("mouseup",function(){
					$(document).off("mousemove");
					$(document).off("mouseup");
					$("#box span").releaseCapture&&$("#box span").releaseCapture();
				});
				$("#box span").setCapture&&$("#box span").setCapture();
				return false;
			});
		});
	</script>
</body>
</html>